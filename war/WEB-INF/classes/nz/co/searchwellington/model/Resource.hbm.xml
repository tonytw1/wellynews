<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>

	<class name="nz.co.searchwellington.model.ResourceImpl"
		proxy="nz.co.searchwellington.model.Resource" table="resource"
		discriminator-value="R">

		<cache usage="read-write" region="nz.co.searchwellington.model.ResourceImpl" />


		<id name="id" type="integer" unsaved-value="0">
			<column name="id" sql-type="integer" not-null="true" />
			<generator class="native" />
		</id>

		<discriminator column="type" type="character" />

		<property name="date" type="date">
			<column name="date" />
		</property>


		<property name="name">
			<column name="title" length="255" not-null="false" />
		</property>
		

		<property name="url">
			<column name="page" length="255" not-null="true" />
		</property>

		<property name="urlWords">
			<column name="url_words" length="255" not-null="false" />
		</property>
		         
		         		         
        <property name="httpStatus" type="integer">
        	<column name="http_status"/>
        </property>
        
      	<property name="held" type="boolean">
        	<column name="held"/>
        </property>
        


		<property name="description" type="text">
			<column name="description" />
		</property>

		<many-to-one name="owner" class="nz.co.searchwellington.model.UserImpl" column="owner" cascade="" />

		<set name="tags" table="resource_tags" access="field">
			<cache usage="read-write" />		
			<key column="resource_id" />
			<many-to-many class="nz.co.searchwellington.model.Tag" column="tag_id" order-by="name" />
		</set>
		
		
		
		<set name="discoveredFeeds" table="discovered_urls_references" >
				<cache usage="read-write" />
				<key column="resource_id" />				
				<many-to-many column="discovered_url_id" class="nz.co.searchwellington.model.DiscoveredFeed" />
		</set>
		


		 <property name="lastScanned" type="timestamp">
        		<column name="last_scanned"/>
        </property>
        
      	<property name="lastChanged" type="timestamp">
        		<column name="last_changed"/>
        </property>
                
   		<property name="liveTime" type="timestamp">
        		<column name="live_time"/>
        </property>
                     
   		<property name="embargoedUntil" type="timestamp">
        		<column name="embargoed_until"/>
        </property>
        
        <many-to-one name="geocode" class="nz.co.searchwellington.model.Geocode" column="geocode_id" 
        	cascade="all" />
		    
        
    	<subclass name="nz.co.searchwellington.model.WebsiteImpl"
			proxy="nz.co.searchwellington.model.Website"
			discriminator-value="W">


			<set name="newsitems" inverse="true" 
					cascade="all,all-delete-orphan">
				<cache usage="read-write" />
				
				<key column="publisher" />
				
				<one-to-many
					class="nz.co.searchwellington.model.NewsitemImpl" />
			</set>

			<set name="feeds" inverse="true" 
				cascade="all,all-delete-orphan">
						<cache usage="read-write" />
				
				<key column="feed_publisher" />
				<one-to-many
					class="nz.co.searchwellington.model.FeedImpl" />
			</set>

			<set name="calendars" inverse="true" 
				cascade="all,delete-orphan">
						<cache usage="read-write" />
				
				<key column="calendar_publisher" />
				<one-to-many
					class="nz.co.searchwellington.model.CalendarFeed" />
			</set>
	


			<set name="watchlist" inverse="true" 
				cascade="all,delete-orphan">
						<cache usage="read-write" />
				
				<key column="watchlist_publisher" />
				<one-to-many
					class="nz.co.searchwellington.model.Watchlist" />
			</set>
		</subclass>


		<subclass name="nz.co.searchwellington.model.NewsitemImpl"
			proxy="nz.co.searchwellington.model.Newsitem"
			discriminator-value="N">

			<many-to-one name="publisher" class="nz.co.searchwellington.model.WebsiteImpl" column="publisher" cascade="" />

			<many-to-one name="feed" class="nz.co.searchwellington.model.FeedImpl" column="feed" cascade="" />
			
			<many-to-one name="commentFeed" class="nz.co.searchwellington.model.CommentFeed" 
				column="comment_feed" cascade="" />
		            	      
		    <many-to-one name="image" class="nz.co.searchwellington.model.Image" 
				column="image_id" cascade="" />
		            	        	        	      		            	        	
		    <many-to-one name="submittingTwit" class="nz.co.searchwellington.model.Twit" column="submitting_twit" />
		    
        	<set name="reTwits" table="newsitem_retwits" access="field">
				<cache usage="read-write" />		
				<key column="resource_id" />
				<many-to-many class="nz.co.searchwellington.model.Twit" column="twit_id" order-by="date" />
			</set>
        		
		</subclass>


		<subclass name="nz.co.searchwellington.model.Watchlist"	discriminator-value="L">
			<many-to-one name="publisher" class="nz.co.searchwellington.model.WebsiteImpl" column="watchlist_publisher" cascade="" />
		</subclass>


		<subclass name="nz.co.searchwellington.model.CalendarFeed"
			proxy="nz.co.searchwellington.model.CalendarFeed"
			discriminator-value="C">

			<many-to-one name="publisher" class="nz.co.searchwellington.model.WebsiteImpl"
				column="calendar_publisher" cascade="" />				
		</subclass>


		<subclass name="nz.co.searchwellington.model.FeedImpl" proxy="nz.co.searchwellington.model.Feed" discriminator-value="F">

			<many-to-one name="publisher" class="nz.co.searchwellington.model.WebsiteImpl" column="feed_publisher" />
			
			<property name="acceptancePolicy" type="text">
  				<column name="acceptance" length="10" not-null="false"/>
			</property>
			
			<property name="latestItemDate" type="date">
        		<column name="latest_item"/>
        	</property> 	
	        
	       	<property name="lastRead" type="timestamp">
        		<column name="last_read"/>
        	</property>
        	
		</subclass>


		

	</class>

</hibernate-mapping>